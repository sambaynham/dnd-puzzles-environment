FROM dunglas/frankenphp

#1 Set working directory
WORKDIR /var/www

#2 CertUtil
RUN apt update && apt install libnss3-tools -y;

#3 Install extensions
RUN install-php-extensions \
    pdo_mysql \
    	gd \
    	intl \
    	zip \
    	opcache

#4 Add user for application
RUN groupadd -g 1000 www
RUN useradd -u 1000 -ms /bin/bash -g www www

COPY --chown=www:www ./Caddyfile /etc/Caddyfile

#5 Copy existing application directory permissions
COPY --chown=www:www . /app/public

ENV XDEBUG_MODE coverage


#6 Change current user to www
USER www